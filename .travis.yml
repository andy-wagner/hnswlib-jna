arch: amd64
language: java

jobs:
  include:
    - stage: "Unit tests"
      name: linux oraclejdk8
      os: linux
      dist: trusty
      script: 
        - jdk_switcher use oraclejdk8
        - java -version
        - clang++ -fPIC -O3 -shared bindings.cpp -I hnswlib -o l hnswlib-jna/src/main/resources/libhnswlib-jna.so
        - mvn test
    - stage: "Unit tests"
      name: linux openjdk8
      os: linux
      script: 
      - jdk_switcher use openjdk8
      - java -version
      - clang++ -fPIC -O3 -shared bindings.cpp -I hnswlib -o l hnswlib-jna/src/main/resources/libhnswlib-jna.so
      - mvn test
    - stage: "Unit tests"
      os: osx
      script: 
        - jdk_switcher use oraclejdk8
        - clang++ -std=c++11 -O3 -shared bindings.cpp -I hnswlib -o l hnswlib-jna/src/main/resources/libhnswlib-jna.dylib
        - mvn test
    - stage: "Unit tests"
      os: windows
      language: cpp
      before_install: 
        - choco install jdk8 --version 8.0.211
        - choco install maven --version 3.6.3
      script: 
        - export JAVA_HOME="/c/Program Files/Java/jdk1.8.0_211/"
        - clang++ -O3 -shared bindings.cpp -I hnswlib -o hnswlib-jna/src/main/resources/libhnswlib-jna.dll
        - /c/ProgramData/chocolatey/lib/maven/apache-maven-3.6.3/bin/mvn test
